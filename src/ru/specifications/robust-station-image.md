# Robust Station Image

**RSI** (Robust Station Image) формат задуман как гибкий, открытый и читаемый способ обозначать иконки внутри спрайт-листов в томе же духе, что и формат BYOND'а `.dmi`. RSI считается "иконкой" и может содержать "состояния" ("states"), которые являются подразделами указанной главной иконки. Эти состояния могут обозначать пользовательские флаги, анимации и направленные иконки прямо "из коробки".

RSI — это папка, имеющая название, оканчивающееся на `.rsi`, и содержащая файл `meta.json` и один или более PNG файлов, соответствующие названиям состояний.

Метаданные изображения (определяющие состояния, анимации и т.д.) хранятся в `meta.json` JSON файле. Сами спрайты хранятся в спрайт-листах как PNG файлы в этой папке. Каждому уникальному спрайту соответствует спрайт-лист с таким же названием.

## JSON

Корень JSON файла содержит следующие значения:

Ключ | Значение
---- | --------
`version` | Простое число, соответствующее версии RSI формата. Может использоваться для определения, какой версии RSI, и для реализации правильного включения режима обратной совместимости, когда требуется.
`size` | Размеры спрайтов внутри RSI, хранящиеся как произвольный лист типа `{x: ?, y: ?}`. Это _не_ размер PNG файлов, хранящихся в спрайт-листе. Это используется для правильного вырезания индивидуальных спрайтов из файлов спрайт-листа.
`states` | Список _"состояний"_, хранящих настоящее содержание RSI, смотрите ниже.
`license` | Может быть упущено. Действующий [SPDX License Identifier](https://spdx.org/licenses/), применимый к этой работе.
`copyright` | Может быть упущено. Другая произвольная информация об авторских правах: название, источник, ...

### Состояния

"Состояние" — это контейнер для метаданных определённого спрайт-листа. Они хранят информацию об их спрайт-листа, такие как задержка анимаций и направления. Состояние имеет соответствующий спрайт-лист.

Состояния имеют одно поле, которое может быть использовано для их различения: S

Ключ | Значение
---- | --------
`name` | Название состояния. Может содержать только буквы нижнего регистра, цифры и некоторые специальные (`_-`) символы.

Состояния не могут иметь одинаковые идентифицирующие значения. Два состояния не могут иметь идентичные названия.

Помимо идентификатора, состояние имеет три остальных поля, связанных со спрайтами, которые видны в игре:

Ключ | Значение
---- | --------
`flags` | Свойственный список типа `key: object` для обозначения дополнительной информации. Пока что нет ни одного его применения. Опционально.
`directions` | Число, соответствующее количеству направлений состояния. Должно быть `1`, `4` или `8`.
`delays` | Может быть упущено. Если задано, то это список задержек для состояния анимированной иконки. Каждый список в списке соответствует направлению. Задержки — числа с плавающей точкой (floats), обозначающие секунды.

Состояния всегда расположены в алфавитном порядке по их соответствующим названиям файлов.

#### Направления

На данный момент есть три поддерживающихся типов направления: `1` (нет направлений), `4` (Север Юг Восток Запад), `8` (Север Юг Восток Запад + диагонали). Эти направления расположены (для расстановки в поле `delays` и для расположения в спрайт-листе) следующим образом:

* Юг
* Север
* Восток
* Запад
* Юго-восток
* Юго-запад
* Северо-восток
* Северо-запад

#### Спрайт-лист

PNG файл, соответствующий состоянию, всегда имеет такое же имя, как и название состояния. Например, состояние с названием "hello" будет `hello.png` на диске.

Файл содержит отдельные состояния с их направлениями и задержками. Размер файла всегда кратен полю `size` у RSI. Спрайты расположены от левого верхнего угла к нижнему правому углу, сначала всегда по горизонтали. Количество спрайтов на строку или столбец всегда делается настолько равным, насколько возможно, при этом строки не должны быть длиннее столбцов, если количество состояний не может быть идеально поделено.

Спрайты записываются сгруппированными по направлению, затем каждая иконка записывается в определенном направлении, поэтому при 4 направлениях, ВСЕ южные состояния должны быть записаны первыми, затем северные и т.д.

### JSON Пример

Учтите, что на практике средство записи JSON вероятнее всего записывает максимально компактный JSON в целях уменьшения размера файла.

```json
{
    "version": 1,

    "license": "CC0-1.0",
    "copyright": "GitHub @PJB3005",

    "size": {
        "x": 32,
        "y": 32
    },
    "states": [
        {
            "name": "hello",
            "flags": {},
            "directions": 4,
            "delays": [
                [1, 1, 1],
                [2, 3, 4],
                [3, 4, 5],
                [4, 5, 6]
            ]
        }
    ]
}
```

## Цели дизайна

* Редактирование RSI должно быть возможно без любого инструментария. Это означает отсутствие метаданных в бинарных файлах.
* RGA должен быть легко сравним на GitHub'е.
* Оно не должно так сильно засорять Git историю при изменениях (предотвратить переписывание больших файлов).
* Один PNG = Одна картинка