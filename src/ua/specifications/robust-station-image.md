# Robust Station Image

Формат **RSI** (Robust Station Image) призначено для гнучкого, відкритого і зрозумілого способу <!--Додайте ще одне вихваляння, яке би тут підійшло! --> окреслення піктограм всередині аркушів спрайтів, подібно до формату `.dmi` в BYOND. RSI вважається "пікторамою" і може містити "стани", які є додатковими частинами цієї піктограми. Ці стани можуть визначати користувацькі прапори, кадри анімації та піктограми різних боків спрайту, що може обертатися.

RSI - це папка з назвою, що закінчується на `.rsi`, яка містить файл `meta.json` та один або декілька PNG-файлів відповідно до назв станів.

Метадані зображення (що визначають стани, анімації тощо) зберігаються у форматі JSON, у файлі `meta.json`. Власне спрайти зберігаються на аркушах спрайтів у вигляді PNG файлів в цій директорії. Кожному унікальному стану відповідає однойменний аркуш спрайту.

## JSON

Корінь файлу JSON містить наступні значення:

Ключ | Що означає
--- | -------
`version` | Число типу integer, що відповідає версії формату RSI. Це може бути використано для ідентифікації версії RSI і дозволить коректно використовувати режими зворотної сумісності, коли це необхідно.
`size` | Розміри спрайтів всередині RSI, що зберігаються у вигляді асоціативного списку `{x: ?, y: ?}`. Це _не_ розмір PNG файлів, у яких зберігається аркуш спрайту. Він використовується для коректного обрізання окремих спрайтів з цілого аркуша спрайту.
`states` | Список _станів_, які є безумовно, найважливішою частиною RSI. Подробиці дивіться нижче.
`license` | Можна не вказувати. Дійсний [Ідентифікатор ліцензії SPDX](https://spdx.org/licenses/), що застосовується до цієї роботи.
`copyright` | Можна не вказувати. Інша довільна інформація про авторські права, така як автор, джерело, ...

### Стани

Стан - це контейнер для метаданих певного аркуша спрайтів. У ньому зберігаються дані, пов'язані зі спрайтом, такі як затримки анімації та напрямки. Стан має відповідний аркуш спрайтів.

Стани мають поле, за яким їх можна розрізняти:

Ключ | Що означає
--- | -------
`name` | Назва стану. Може містити лише малі літери, цифри та деякі спеціальні символи (`_-`).

Різні стани не мають мати однаковий ідентифікатор. Два стани з однаковою назвою не можуть існувати.

Окрім ідентифікатора, стан має ще три інші поля, що пов'язані з різними елементами спрайта:

Ключ | Що означає
--- | -------
`flags` | Асоціативний список типу `key: object`, призначений для визначення додаткових даних. Наразі не використовується. Можна не вказувати.
`directions` | Число, що відповідає кількості напрямків, які має стан. Це має бути `1`, `4` або `8`.
`delays` | Можна не вказувати. Якщо визначено, це список зі списків затримок для анімованого стану піктограми. Кожен список у списку відповідає напрямку стану. Затримка є числам типу float і позначає секунди.

Стани завжди впорядковані в алфавітному порядку відповідно до назви їхнього файлу.

#### Напрямки

Наразі підтримується три типи напрямків: `1` (без напрямків), `4` (Північ Південь Схід Захід) та `8` (Північ Південь Схід Захід плюс діагоналі).
Ці напрямки вказуються (щоб відповідати записам у полі `delays` і порядку піктограм на аркуші спрайтів) у наступному порядку:

* Південь
* Північ
* Схід
* Захід
* Південний схід
* Південний захід
* Північний схід
* Північний захід

#### Аркуш спрайтів

PNG-файл, що супроводжує стан, завжди має таку саму назву, як і відоповідний йому стану. Наприклад, стан з назвою "hello" буде відповідати файлу з назвою `hello.png`.

Файл містить окремі спрайти, що відповідають станам, таким як напрямки та кадри анімації. Розмір файлу завжди кратний розміру, зазначеному в полі `size`. Спрайти впорядковано від лівого верхнього кута до правого нижнього, при цьому спочатку йдуть по горизонталі. Кількість спрайтів у рядку та стовпці завжди має бути максимально однаковою, віддаючи перевагу тому, щоб рядки були довшими за стовпці, якщо стани не можуть бути розподілені ідеально.

Спрайти в аркуші спрайтів групуються за напрямками, і кожна піктограма розміщується в цих групах так, що при 4 напрямках спочатку йдуть ВСІ стани, що відповідають півдню, потім півночі і т.д...

### Приклад JSON

Зауважте, що на практиці функція запису JSON, ймовірно, створить якомога компактніший JSON, щоб зменшити розмір файлу. 

```json
{
    "version": 1,

    "license": "CC0-1.0",
    "copyright": "GitHub @PJB3005",

    "size": {
        "x": 32,
        "y": 32
    },
    "states": [
        {
            "name": "hello",
            "flags": {},
            "directions": 4,
            "delays": [
                [1, 1, 1],
                [2, 3, 4],
                [3, 4, 5],
                [4, 5, 6]
            ]
        }
    ]
}
```

## Мета цього дизайну

* Редагування RSI повинно бути можливим без належного інструментарію. Це означає відсутність двійкових метаданих або метаданих всередині PNG файлів.
* Він має легко сприйматись інструментами, що показують різницю версій файлу на GitHub.
* Він не повинен занадто сильно роздувати історію Git'a при внесенні великих змін (запобігає перезапису великих файлів).
* Один PNG файл - Одне Зображення